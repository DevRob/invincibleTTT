$(function(){function e(e,t){var r=Array.apply(null,Array(e));return r.map(function(){return t})}function t(e){return e[parseInt(Math.floor(Math.random()*e.length))]}function r(e,t){var r=10,n={0:{score:t-r},1:{score:r-t},2:{score:0}};return n[e]}function n(e,t,i){i+=1;var o=[],s={},u=e.getEmptySquares(),c=e.checkWin().player;if(null!==c)return r(c,i);for(var l=0,h=u.length;h>l;l++)s=new x(e.squares),s.move(u[l],t),o.push({score:n(s,a(t),i).score,move:u[l]});return o.sort(function(e,t){return e.score-t.score}),t===v?o[0]:t==m?o[o.length-1]:void 0}function a(e){return(e+1)%2}function o(){location.reload()}function s(){var e=y();e&&(d=new k(e),f=new z(d),f.hideMenu().showScoreScreen().smoothening().drawBoard(),u())}function u(e){var t=d.getPlayerType();d.inProgress()?"A.I."==t?setTimeout(function(){l()},750):h():setTimeout(function(){d.resetGame(),u()},1250),f.updateBoard()}function c(e){var t=f.getSquareIndex(e),r=d.board.getSquare(t);null===r&&(d.board.move(t,d.currentPlayer),d.switchPlayer(),p(),u())}function l(){var e={};e=d.board.isEmpty()?{score:10,move:t(d.board.getEmptySquares())}:n(d.board,d.currentPlayer,0),d.board.move(e.move,d.currentPlayer),d.switchPlayer(),u()}function h(){f.canvas.addEventListener("mousedown",c)}function p(){f.canvas.removeEventListener("mousedown",c)}function y(){var e={boardSize:3,player1Type:$("#radio1").children(".checked").attr("data-ptype1"),player2Type:$("#radio2").children(".checked").attr("data-ptype2"),firstMove:$("#radio3").children(".checked").attr("data-firstmove")},t={boardSize:e.boardSize,player1:{playerType:e.player1Type,playerName:$("#input-4").val()},player2:{playerType:e.player2Type,playerName:$("#input-5").val()},firstMove:e.firstMove};for(var r in e)if(e.hasOwnProperty(r)&&!e[r])return void alert("Please set: "+r);return t}var d,f,g=3,v=0,m=1,w=2,S="#27a8e0",q="#8894a0",b="#626e7a",x=function(t){t?this.squares=t.slice():this.squares=e(Math.pow(g,2),null)};x.prototype.move=function(e,t){this.squares[e]=t},x.prototype.getEmptySquares=function(){var e=[];return this.squares.forEach(function(t,r){null==t&&e.push(r)}),e},x.prototype.getSquare=function(e){return this.squares[e]},x.prototype.checkWin=function(){for(var e={player:null,line:null},t=this.getWinnerLines(),r=0,n=t.length;n>r;r++){var i=new Set(t[r]);if(1===i.size){if(e.player=i.values().next().value,null!==e.player){e.line=r;break}}else this.isFull()&&(e.player=w)}return e},x.prototype.getWinnerLines=function(){var e=[];return e.extend=function(e){return this.push.apply(this,e),this},e.extend(this.getRows()).extend(this.getCols()).extend(this.getDiagonals()),e},x.prototype.getRows=function(){var e=[[],[],[]];return this.squares.forEach(function(t,r){e[parseInt(r/g)].push(t)}),e},x.prototype.getCols=function(){var e=[[],[],[]];return this.squares.forEach(function(t,r){e[parseInt(r%g)].push(t)}),e},x.prototype.getDiagonals=function(){var e=this.squares,t=[[],[]];for(i=0;i<g;i++)t[0].push(e[i*g+i]),t[1].push(e[(i+1)*(g-1)]);return t},x.prototype.isEmpty=function(){return this.getEmptySquares().length==Math.pow(g,2)?!0:!1},x.prototype.isFull=function(){return 0==this.getEmptySquares().length?!0:!1};var P=function(e){function r(e){return e?e:t(["bob","tom","selly","katy","zorg"])}this.playerName=r(e.playerName),this.playerType=e.playerType},k=function(e){this.board=new x,this.currentPlayer=this.setFirstPlayer(e.firstMove),this.players={0:new P(e.player1),1:new P(e.player2)}};k.prototype.setFirstPlayer=function(e){return e>1?t([v,m]):parseInt(e)},k.prototype.switchPlayer=function(){this.currentPlayer=a(this.currentPlayer)},k.prototype.inProgress=function(){var e=this.board.checkWin().player;return null===e?!0:!1},k.prototype.resetGame=function(){this.board=new x,this.switchPlayer()},k.prototype.getPlayerType=function(){return this.players[this.currentPlayer].playerType};var z=function(e){this.game=e,this.canvas=document.getElementById("canvas"),this.ctx=this.canvas.getContext("2d"),this.menu=document.getElementById("menu"),this.scoreScreen=document.getElementById("scoreScreen"),this.winnerCount=[0,0,0]};z.prototype.updateBoard=function(){var e=this;e.clearCanvas().refreshCounter().drawBoard(),e.game.board.squares.forEach(function(t,r){t==v?e.drawNought(r):t==m&&e.drawCross(r)}),e.drawWin()},z.prototype.drawBoard=function(){var e=.6*window.innerHeight;this.canvas.width=this.canvas.height=e,this.squareSize=e/3;for(var t=1;3>t;t++){start=[this.squareSize*t,0],end=[this.squareSize*t,e];for(var r=0;2>r;r++)this.line(start,end,0,q,5),start.reverse(),end.reverse()}},z.prototype.drawNought=function(e){var t=this.squareSize/4,r=this.getCoord(e);this.circle(r,t,b,this.squareSize/10)},z.prototype.drawCross=function(e){var t=this.squareSize/3,r=this.getCoord(e),n=[r.y-t,r.x],i=[r.y+t,r.x];this.line(n,i,45,S,this.squareSize/10),this.line(n,i,135,S,this.squareSize/10)},z.prototype.drawWin=function(){var e,t=this.game.board.checkWin();(t.player==v||t.player==m)&&(e=this.buildLine(this.winLineProp(t.line)),this.line(e.start,e.end,e.angle,q,this.squareSize/7))},z.prototype.buildLine=function(e){var t=this.getCoord(e.midpoint),r=(e.scale,e.angle),n=[t.y-this.squareSize*e.scale,t.x],i=[t.y+this.squareSize*e.scale,t.x];return{start:n,end:i,angle:r}},z.prototype.winLineProp=function(e){var t={0:{midpoint:1,scale:1.1,angle:2},1:{midpoint:4,scale:1.1,angle:-2},2:{midpoint:7,scale:1.1,angle:1},3:{midpoint:3,scale:1.1,angle:91},4:{midpoint:4,scale:1.1,angle:89},5:{midpoint:5,scale:1.1,angle:88},6:{midpoint:4,scale:1.5,angle:47},7:{midpoint:4,scale:1.5,angle:132}};return t[e]},z.prototype.line=function(e,t,r,n,i){var a=Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)),o=a/2*Math.sin(r*Math.PI/180),s=o/Math.tan((360-r/2-90)*Math.PI/180),u=this.ctx;u.beginPath(),u.moveTo(e[0]+s,e[1]-o),u.lineTo(t[0]-s,t[1]+o),u.strokeStyle=n,u.lineCap="round",u.lineWidth=i,u.stroke()},z.prototype.circle=function(e,t,r,n){var i=this.ctx;i.beginPath(),i.arc(e.y,e.x,t,0,2*Math.PI),i.strokeStyle=r,i.lineWidth=n,i.stroke()},z.prototype.getCoord=function(e){return{x:this.squareSize*(parseInt(e/3)+.5),y:this.squareSize*(e%3+.5)}},z.prototype.getSquareIndex=function(e){var t=parseInt(e.offsetY/this.squareSize),r=parseInt(e.offsetX/this.squareSize);return 3*t+r},z.prototype.clearCanvas=function(){return this.ctx.clearRect(0,0,canvas.width,canvas.height),this},z.prototype.hideMenu=function(){return this.menu.style.display="none",this},z.prototype.showScoreScreen=function(){return this.scoreScreen.style.display="block",$(".player1").text(d.players[0].playerName),$(".player2").text(d.players[1].playerName),this},z.prototype.refreshCounter=function(){var e=this.winnerCount;return e[this.game.board.checkWin().player]+=1,$("#0").children("span").text(e[0]),$("#1").children("span").text(e[1]),$("#2").children("span").text(e[2]),this},z.prototype.smoothening=function(){return ctx=this.ctx,ctx.mozImageSmoothingEnabled=!0,ctx.msImageSmoothingEnabled=!0,ctx.imageSmoothingEnabled=!0,this},$(".fake-button").on("click",function(){$(this).parent(".button-bar").find("img").addClass("gray-filter"),$(this).siblings(".fake-button").removeClass("checked"),$(this).children("img").removeClass("gray-filter"),$(this).addClass("checked")}),$("#startGame").on("click",s),$("#newgame").on("click",o)});
